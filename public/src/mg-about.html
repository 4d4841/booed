<!DOCTYPE html>
<!--
 .................................................................................................
:::BSDB'::BSDB'::BSDB':::::BSDB':::BSDBS'::BSDBS'::BSDB'::::BSD'::BSDBS'::BSDBS'::BSDB'::::::BSD'::
::BSDBSD BSDBSD :.BSDBS':BSDBS .:BSD ..BSD  ...BSD 'BSDBS':BSD .BSD ..BSD  ...BSD :BSDBS'::BSDB .::
::COPYRIGHT2017 ::.BS BSDB .BS :BSD .::.BSD :::.BSD :BS .BSDB .BSD .:::BSD ::::BSD :BS BSDB BS .:::
:::BSDSTYLEBSD .:::BS  BS .:BS :BSD ::::BSD ::::BSD :BS ::BSD :BSD :::::...::::BSD :BS :BS  BS ::::
::::.LICENSE .::::BSD .:..::BS 'BSD ::::BSD ::::BSD :BS :::BS :BSD ::BSDBS'::::BSD :BS ::..:BS ':::
:::::::BSD .::::BSDB .::::::BSD 'BSD'::BSD .:::BSD .BSD :::BSD':BSD'::.BSD :::BSD .BSD :::::BSDB'::
::::::::B .::::::BS .:::::::.BSD ::BSDBS .:BSDBS  :BSD .::::BSD :.BSDBS BS BSDB .:BSD .:::::.BS .::
`::::::::.::::::::..::::::::::...:::.....:::.....:::...::::::...:::.............:::...::::::::..::'
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-slider/paper-slider.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/iron-iconset-svg/iron-iconset-svg.html">
<link rel="import" href="../bower_components/iron-icons/av-icons.html">
<link rel="import" href="../bower_components/iron-icons/communication-icons.html">
<link rel="import" href="../bower_components/iron-icons/device-icons.html">
<link rel="import" href="../bower_components/iron-icons/editor-icons.html">
<link rel="import" href="../bower_components/iron-icons/hardware-icons.html">
<link rel="import" href="../bower_components/iron-icons/image-icons.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-icons/maps-icons.html">
<link rel="import" href="../bower_components/iron-icons/notification-icons.html">
<link rel="import" href="../bower_components/iron-icons/places-icons.html">
<link rel="import" href="../bower_components/iron-icons/social-icons.html">

<link rel="import" href="mg-button.html">
<link rel="import" href="mg-icons.html">
<link rel="import" href="mg-input.html">
<link rel="import" href="mg-sections.html">

<dom-module id="mg-about">
  <template>
      <custom-style>
    <style include="iron-flex iron-flex-alignment">

      :host {
        color: var(--app-secondary-color);
        @apply --layout-vertical;
        @apply --layout-center;
        @apply --layout-center-justified;
      }

      h1 {
        font-weight: 300;
      }

      .github {
        margin-top: 50px;
        width: 240px;
        height: 240px;
        border-radius: 40px;
        padding: 10px;
        overflow: hidden;
        @apply --layout-vertical;
        @apply --layout-center;
        --paper-card-content: {
          box-shadow: inset 0px 5px 6px -3px rgba(255, 0, 0, 1.0);
        }
      }

      paper-slider {
        height: 20px;
        width: 300px;
      }

      .button {
        width: 80px;
        height: 80px;
      }

      .logo-button {
        width: 400px;
        height: 100px;
        margin-left: 15px;
          border-radius: 0;
        --paper-button: {
          border-radius: 0;
        }
      }

      a:link {
        text-decoration: none;
      }

      .display-icon {
        display: block;
        @apply --layout-center;
        @apply --layout-center-justified;
        width: calc(var(--display-icon-size,21px) + 10px);
        height: calc(var(--display-icon-size,21px) + 10px);
        --iron-icon-width: var(--display-icon-size,21px);
        --iron-icon-height: var(--display-icon-size,21px);
        /*
        --iron-icon-width: 32px;
        --iron-icon-height: 32px;
        */
        @apply --layout-vertical;
        @apply --layout-center;
      }

      .display-icon-card {
        font-size: 10px;
        min-width: 80px;
        @apply --layout-vertical;
        @apply --layout-center;
        @apply --layout-start-justified;
        width: calc(var(--display-icon-size,21px) + 20px);
        padding: 5px;
        word-wrap: break-word;
        margin: 5px;
      }

      .display-icon-card[matched] .display-icon {
        color: var(--google-blue-700);
      }

      .display-icon-card[matched] {
        border-radius: 10px;
        background-color: white;
        box-sizing: content-box;
      }

      mg-sections {
        background-color: snow;
        width: calc(100vw - 20px);
        border-bottom:1px dashed var(--app-shadow-color)
      }

    </style>
      </custom-style>

    <iron-pages
      class="vertical layout center"
      selected="[[page]]"
      attr-for-selected="name"
      selected-attribute="visible"
      fallback-selection="card"
    > <paper-card class="github layout self-center" name="card">
        <a href="/">
          <paper-icon-button src="/images/logo-bounce-in.svg" class="logo-button layout vertical center-justified" noink>
        </a>
        <a href="https://github.com/4d4841/booed">
          <paper-icon-button src="https://assets-cdn.github.com/images/modules/logos_page/Octocat.png" class="button layout vertical center-justified" noink>
          </paper-icon-button>
        </a>
      </paper-card>

      <div name="icons" style="width:100%;height:100%;font-size:16px" class="vertical layout">

          <template is="dom-if" if="[[clickedIcon]]">
        <paper-card style="border-radius:5px;color:black;max-width:calc(100vw - 30px);height:auto;margin:10px;background-color:lavender;padding:20px;word-wrap:break-all">
          <paper-icon-button icon="close" on-click="_closePath"></paper-icon-button>
          [[clickedIcon]]
        </paper-card>
          </template>

            <div class="horizontal layout start-justified wrap" style="box-sizing:border-box ;border-bottom: 1px dashed var(--app-shadow-color)">
          <template id="repeater" is="dom-repeat" items="{{iconSets}}">
        <paper-checkbox checked="{{item.show}}" style="height:30px;margin-left: 10px; font-size:14px">
          [[item.name]]
        </paper-checkbox>
          </template>
            </div>


          <app-toolbar style="border-bottom:1px dashed var(--app-shadow-color)">
        <div style="margin-top:20px" >Size:</div>
        <paper-slider style="margin-top:20px" value="{{iconSize}}" min="10" max="200" editable></paper-slider>
        <div class="flex"></div>

        <mg-input
          label="Space-separated keywords or regexes"
          icon="search"
          value="{{willSearch}}"
          autofocus
        ></mg-input>
          </app-toolbar>

        <mg-sections sections="{{iconSections}}" class="icons-container horizontal layout wrap">

            <template id="repeater" is="dom-repeat" items="[[iconList]]">
          <div slot="[[item.section]]" class="display-icon-card" on-click="_addIcon" matched$="[[_matchesSection(item.section)]]">
            <div class="display-icon vertical layout center">
              <iron-icon icon="[[item.set]]:[[item.id]]"></iron-icon>
            </div>
            <span style="word-wrap:break-word;width:calc(100% - 10px)"> [[item.set]]:[[item.id]] </span>
          </div>
            </template>

        </mg-sections>


<!--
        <div style="width:100%;margin:10px;" class="icons-container horizontal layout wrap">
          <template is="dom-repeat" items="[[iconList]]" filter="[[_contains(search)]]">
            <div class="display-icon-card" on-click="_addIcon">
              <div class="display-icon vertical layout center">
                <iron-icon icon="[[item.set]]:[[item.id]]"></iron-icon>
              </div>
              <span style="word-wrap:break-word;width:calc(100% - 10px)"> [[item.set]]:[[item.id]] </span>
            </div>
          </template>
          <template is="dom-repeat" items="[[iconList]]" filter="[[_contains(search,1)]]">
            <div class="display-icon-card" on-click="_addIcon">
              <div style="color:gainsboro;" class="display-icon vertical layout center">
                <iron-icon icon="[[item.set]]:[[item.id]]"></iron-icon>
              </div>
              <span style="word-wrap:break-word;width:calc(100% - 10px)"> [[item.set]]:[[item.id]] </span>
            </div>
          </template>
        </div>
      -->

        <!--footer-->
        <div style="height:50px">
        </div>

      </div>


    </iron-pages>

  <app-route
      route="{{route}}"
      pattern="/:page"
      data="{{routeData}}"
      tail="{{subroute}}">
  </app-route>

  </template>
  <script>

    class MGAbout extends Polymer.Element {
      static get is() { return 'mg-about'; }

      _metaChanged(meta) {
        console.log('meta',meta);
      }

      static get properties() { return {

        testMeta: {
          observer: '_metaChanged'
        },

        menu: {
          type: Object,
          value: { entries: [
            { name:"tos", path:"/about/tos", icon:"info", title:"เงื่อนไขการให้บริการ", },
            { name:"policy", path:"/about/privacy-policy", icon:"info", title:"นโยบายความเป็นส่วนตัว"},
          ]}
        },

        visible: {
          type: Boolean,
          observer: '_visibleChanged'
        },

        route: {
          type: Object,
          notify: true,
          observer: '_routeChanged'
        },

        _meta: {
          value: Polymer.Base.create('iron-meta', {type: 'iconset'})
        },

        iconSize: {
          value: 30,
          observer: '_iconSizeChanged'
        },

        willSearch: {
          observer: '_willSearchChanged'
        },

        iconSets: {
          type: Array,
          value: () => [],
        },

        iconSections: {
          type: Array,
          computed: '_computeIconSections(iconSets.*)',
        },

      }}

      static get observers() { return [
      ]}

      _iconSizeChanged(size) {
        this.updateStyles({
          '--display-icon-size':`${size}px`
        });
      }

      _computeIconSections(changes) {
        let iconSets = this.iconSets;
        let sections = [];
        iconSets.forEach(set => {
          if (set.show) {
            sections.push(set.name+"#matched");
          }
        });
        iconSets.forEach(set => {
          if (set.show) {
            sections.push(set.name);
          }
        });

        return sections;
      }

      connectedCallback() {
        super.connectedCallback();

        this.set('iconList', []);

        let sets = Polymer.IronMeta.types['iconset'];
        for (let setname in sets) {
          this.push('iconSets',{name:setname, show: true});
          sets[setname].getIconNames().forEach(name => {
            let n = name.split(':');
            this.push('iconList',{set:n[0],id:n[1],section:n[0]});
          });
        }
      }

      _routeChanged( route) {
        if (route.prefix == '/about') {
          this.set('page', this.routeData.page);
        }
      }

      _visibleChanged(visible) {
        if (visible) {
          let page = this.page;
          this.dispatchEvent(new CustomEvent('change-section', {
            bubbles: true, composed: true, detail: {title: (page ? (page.charAt(0).toUpperCase() + page.slice(1) + " - "):'') + 'About', target:this}}));
        }
      }

      _matchesSection(sectionName) {
        return sectionName.split('#').pop() == 'matched'
      }

      _addIcon(e) {
        let el = this._meta.byKey(e.model.item.set).querySelector('g[id="'+e.model.item.id+'"]');
        this.set('clickedIcon',new XMLSerializer().serializeToString(el).replace('xmlns="http://www.w3.org/2000/svg"',''));
      }

      _closePath(e) {
        this.set('clickedIcon',null);
      }

      _willSearchChanged(willSearch) {
        this._willSearchDebouncer = Polymer.Debouncer.debounce(this._willSearchDebouncer,
          Polymer.Async.timeOut.after(500), () => {
            //this.set('search', willSearch);
            let regs = [];
            willSearch.split(' ').forEach(v => {
              if (v !== '') regs.push(new RegExp(v))
            });

            this.iconList.forEach((icon,index) => {
              if (regs.some( regex => regex.test(icon.id) )) {
                this.set(['iconList',index,'section'],this.iconList[index].set+'#matched');
              } else {
                this.set(['iconList',index,'section'],this.iconList[index].set);
              }
            });
          });
      }
    }

    customElements.define(MGAbout.is, MGAbout);

  </script>
</dom-module>
