<!DOCTYPE html>
<!--
 .................................................................................................
:::BSDB'::BSDB'::BSDB':::::BSDB':::BSDBS'::BSDBS'::BSDB'::::BSD'::BSDBS'::BSDBS'::BSDB'::::::BSD'::
::BSDBSD BSDBSD :.BSDBS':BSDBS .:BSD ..BSD  ...BSD 'BSDBS':BSD .BSD ..BSD  ...BSD :BSDBS'::BSDB .::
::COPYRIGHT2017 ::.BS BSDB .BS :BSD .::.BSD :::.BSD :BS .BSDB .BSD .:::BSD ::::BSD :BS BSDB BS .:::
:::BSDSTYLEBSD .:::BS  BS .:BS :BSD ::::BSD ::::BSD :BS ::BSD :BSD :::::...::::BSD :BS :BS  BS ::::
::::.LICENSE .::::BSD .:..::BS 'BSD ::::BSD ::::BSD :BS :::BS :BSD ::BSDBS'::::BSD :BS ::..:BS ':::
:::::::BSD .::::BSDB .::::::BSD 'BSD'::BSD .:::BSD .BSD :::BSD':BSD'::.BSD :::BSD .BSD :::::BSDB'::
::::::::B .::::::BS .:::::::.BSD ::BSDBS .:BSDBS  :BSD .::::BSD :.BSDBS BS BSDB .:BSD .:::::.BS .::
`::::::::.::::::::..::::::::::...:::.....:::.....:::...::::::...:::.............:::...::::::::..::'
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="mg-common-styles.html">
<link rel="import" href="mg-item-image.html">

<dom-module id="mg-clipboard">
  <template strip-whitespace>
      <custom-style>
    <style is="custom-style" include="mg-common-styles iron-flex iron-flex-alignment">

      .copied-collapse {
        background-color: white;
        border-radius: 5px;
        margin-bottom: 20px;
      }

      .copied-container {
        @apply(--layout-horizontal);
        @apply(--layout-wrap);
        box-shadow: inset 1px 1px 1px var(--app-shadow-color);
        border-radius: 5px;
        padding: 5px;
        margin: 5px;
        background-color: rgba(0,0,0,0.02);
      }

      .copied-icon {
        margin: 0 5px 5px 0;
        width: 80px;
        height: 80px;
      }

      .copied-icon:hover .image-edit-button-icon {
        opacity: 1;
      }

      .image-edit-button-icon {
        opacity: 0.6;
        position: absolute;
        right: 0;
        top: 0;
        width: 25px;
        height: 25px;
        @apply(--layout-self-end);
        z-index: 3;
        color: black;
        background-color: white;
        box-shadow: inset 1px -1px 1px var(--app-shadow-color);
        border-radius: 0 0 0 25%;
        padding: 3px;
        --iron-icon-width: 20px;
        --iron-icon-height: 20px;
        transition: opacity 1s;
      }

    </style>
      </custom-style>

    <iron-collapse class="copied-collapse vertical layout" opened="[[clipboardList.length]]">

      <div class="copied-container">
        <template is="dom-repeat" items="{{clipboardList}}">

          <mg-item-image
            key="[[item.key]]"
            class="copied-icon"
            thumbnail="[[item.thumbnail]]"
            rep="[[item.rep]]"
            roi="[[item.roiThumbnail]]"
            name="[[item.name]]"
            deleted="[[item.deleted]]"
            on-tap="_onCopiedTap"
          >
            <paper-icon-button icon="mode-edit" class="image-edit-button-icon" on-tap="_onEditImage">
            </paper-icon-button>
          </mg-item-image>

        </template>
      </div>

      <div class="horizontal layout center-justified wrap">
        <paper-button class="horizontal layout start-justified" on-tap="_onPasteClipboardTap">
          <iron-icon icon="content-paste"></iron-icon> เพิ่มลงแกลเลอรี่
        </paper-button>
        <paper-button class="horizontal layout start-justified" on-tap="_onClearClipboardTap">
          <iron-icon icon="cancel"></iron-icon> เคลียร์คลิปบอร์ด
        </paper-button>
      </div>
    </iron-collapse>

    <mg-image-editor
      id="image-editor"
      data="{{editingData}}"
      blob="{{blob}}"
      after="[[afterEditingData]]"
      before="[[beforeEditingData]]"
    ></mg-image-editor>


  </template>
  <script>
    class MGClipboard extends Polymer.Element {
      static get is() { return 'mg-clipboard'; }

      static get properties() { return {
        clipboardList: {
          type: Array,
          value: [],
          notify: true,
        },

        pastedData: {
          type: Array,
          notify: true,
          readOnly: true,
        },

        imageEditing: {
          type: Object,
          notify: true,
        },

      }}

      static get observers() { return [
      ]}

      _onClearClipboardTap(e) {
        this.splice('clipboardList', 0, this.clipboardList.length);
      }

      _onPasteClipboardTap(e) {
        this._setPastedData( this.clipboardList.filter(item => { return item.deleted ? false : true; }));
      }

      _onCopiedTap(e) {
        //Toggles deleted true and it won't be pasted.
        let idx = this.clipboardList.indexOf(e.model.item);
        this.set(['clipboardList',idx,'deleted'], this.clipboardList[idx].deleted ? false : true);
      }

      _onEditImage(e) {
        let data = e.model.item;
        this.set('editingData',data);
        e.stopImmediatePropagation();
      }


    }

    customElements.define(MGClipboard.is, MGClipboard);
  </script>
</dom-module>
