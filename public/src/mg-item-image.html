<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="../bower_components/neon-animation/web-animations.html">
<link rel="import" href="mg-common-styles.html">
<link rel="import" href="mg-icons.html">

<dom-module id="mg-item-image">
  <template strip-whitespace>
      <custom-style>
    <style include="mg-common-styles iron-flex iron-flex-alignment">
      :host {
      }

      :host(.iron-selected) .photo-frame {
        border: 2px solid tomato;
      }

      :host(:not(.iron-selected)) .photo-frame {
        border: 2px solid white;
      }

      .photo-frame {
        width: 100%;
        height: 100%;
        text-decoration: none;
        padding: 0;
        margin: 5px;
        border-radius: 5px;
        @apply(--layout-vertical);
        box-shadow: 1px 1px 1px var(--app-shadow-color);
        background-color: white;
        overflow: hidden;
        border: 2px solid white;
      }

      .photo-frame > iron-image {
        width: 100%;
        height: 100%;
        background-color: whitesmoke;
        border-radius: 5px;
      }

      paper-progress {
        width: 90%;
        pointer-events: none;
        position: absolute;
        top: 5px;
      }

      .label {
        width: 100%;
        text-transform: none;
        white-space: nowrap;
        position: absolute;
        bottom: 0;
        /*background-color: rgba(255,255,255,0.85);*/
        color: black;
        background: linear-gradient( transparent 0, rgba(255,255,255,0.8) 15px)
                    ,linear-gradient( transparent 0,rgba(255,255,255,0.5) 10px);
        height: 20px;
        line-height: 25px;
        z-index: 1;
        text-align: center;
        @apply(--layout-horizontal);
        @apply(--layout-center-justified);
      }

      .icon {
        --iron-icon-width: 15px;
        --iron-icon-height: 15px;
        min-width: 20px;
      }

    </style>
      </custom-style>

    <paper-button class="photo-frame">
      <iron-image
        src="[[src]]"
        sizing="cover"
        placeholder="images/logo-pumpkin-gray-bouncing.svg"
        preload
        fade
      ></iron-image>
      <template is="dom-if" if="{{showProgress}}">
        <paper-progress
          value="[[progress]]"
        ></paper-progress>
      </template>

      <div class="label horizontal layout center start-justified">
        <template is="dom-if" if="{{role}}">
          <iron-icon class="icon" icon="[[_iconForRole(role)]]"></iron-icon>
        </template>
        <template is="dom-repeat" items="{{_formatRoles(roles)}}">
          <iron-icon class="icon" style="[[_formatRoleStyle(item)]]" icon="[[_iconForRole(item)]]"></iron-icon>
        </template>
        <div id="labelSpan">[[label]]</div>
      </div>
    </paper-button>
    <paper-tooltip id="tooltip" animation-delay="0">
      [[label]]
    </paper-tooltip>

  </template>
  <script>
    class MGItemImage extends Polymer.GestureEventListeners(Polymer.Element) {
      static get is() { return 'mg-item-image'; }

      static get properties() { return {
        src: {
          type: String,
          value: "",
        },

        role: String,

        label: {
          type: String,
          value: "",
        },

        progress: {
          type: Number,
        },

        showProgress: {
          type: Boolean,
          computed: '_computeShowProgress(progress)',
        },

      }}

      static get observers() { return [
      ]}

      _formatRoleStyle(role) {
        if (role == "new-releases") return "color:gold";
        if (role == "sales") return "color:red";
        if (this.roles[role] === true) {
          return "color:tomato";
        }  else if (this.roles[role] === false) {
          return "color:black";
        }
        return "color:lightgray";
      }

      _formatRoles(roles) {
        return Object.keys(roles);
      }

      _iconForRole(role) {
        return MGIconForRole(role);
      }


      /*
      connectedCallback() {
        super.connectedCallback();
        Polymer.Gestures.addListener(this, 'track', this.handleTap.bind(this));
      }
      disconnectedCallback(){
        super.disconnectedCallback();
      }
      */

      handleTap(e) {
        console.log(e);
      }

      _computeShowProgress(progress) {
        if (typeof(progress) == "undefined") return false;
        if (progress == 100) return false;
        return true;
      }

      /*
      _onMOver(e) {
        if (this.$.labelSpan.offsetWidth > this.offsetWidth) {
          this.$.tooltip.show();
        }
      }

      _onMOut(e) {
        this.$.tooltip.hide();
      }
      */
    }

    customElements.define(MGItemImage.is, MGItemImage);
  </script>
</dom-module>
u
