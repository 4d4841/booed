<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="../bower_components/neon-animation/web-animations.html">
<link rel="import" href="mg-common-styles.html">

<dom-module id="mg-item-image">
  <template strip-whitespace>
      <custom-style>
    <style include="mg-common-styles iron-flex iron-flex-alignment">
      :host {
        margin: 5px;
      }

      .photo-thumbnail {
        width: 100%;
        height: 100%;
        background-color: whitesmoke;
        border-radius: 5px;
      }

      .photo {
        width: 100%;
        height: 100%;
        text-decoration: none;
        padding: 0;
        margin: 5px;
        border-radius: 5px;
        @apply(--layout-vertical);
        box-shadow: 1px 1px 2px var(--app-shadow-color);
        background-color: white;
        overflow: hidden;
        border: 2px solid white;
      }

      paper-progress {
        width: 90%;
        pointer-events: none;
        position: absolute;
        top: 5px;
      }

      .label {
        width: 100%;
        text-transform: none;
        white-space: nowrap;
        position: absolute;
        bottom: 0;
        /*background-color: rgba(255,255,255,0.85);*/
        color: black;
        background: linear-gradient( transparent 0, rgba(255,255,255,0.8) 15px)
                    ,linear-gradient( transparent 0,rgba(255,255,255,0.5) 10px);
        height: 20px;
        line-height: 25px;
        z-index: 1;
        text-align: center;
        @apply(--layout-horizontal);
        @apply(--layout-center-justified);
      }

    </style>
      </custom-style>

    <paper-button class="photo">
      <iron-image
        class="photo-thumbnail"
        src="[[src]]"
        sizing="cover"
        placeholder="images/logo-pumpkin-outline-grayout.svg"
        preload
        fade
      ></iron-image>
      <template is="dom-if" if="{{showProgress}}">
        <paper-progress
          value="[[progress]]"
        ></paper-progress>
      </template>

      <div class="label"><span id="labelSpan">[[label]]</span></div>
    </paper-button>
    <paper-tooltip id="tooltip" animation-delay="0">
      [[label]]
    </paper-tooltip>

  </template>
  <script>
    class MGItemImage extends Polymer.GestureEventListeners(Polymer.Element) {
      static get is() { return 'mg-item-image'; }

      static get properties() { return {
        src: {
          type: String,
          value: "",
        },

        label: {
          type: String,
          value: "",
        },

        progress: {
          type: Number,
        },

        showProgress: {
          type: Boolean,
          computed: '_computeShowProgress(progress)',
        },

      }}

      static get observers() { return [
      ]}


      /*
      connectedCallback() {
        super.connectedCallback();
        Polymer.Gestures.addListener(this, 'track', this.handleTap.bind(this));
      }
      disconnectedCallback(){
        super.disconnectedCallback();
      }
      */

      handleTap(e) {
        console.log(e);
      }

      _computeShowProgress(progress) {
        if (typeof(progress) == "undefined") return false;
        if (progress == 100) return false;
        return true;
      }

      /*
      _onMOver(e) {
        if (this.$.labelSpan.offsetWidth > this.offsetWidth) {
          this.$.tooltip.show();
        }
      }

      _onMOut(e) {
        this.$.tooltip.hide();
      }
      */
    }

    customElements.define(MGItemImage.is, MGItemImage);
  </script>
</dom-module>
