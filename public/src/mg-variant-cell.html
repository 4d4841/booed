<!DOCTYPE html>
<!--
 .................................................................................................
:::BSDB'::BSDB'::BSDB':::::BSDB':::BSDBS'::BSDBS'::BSDB'::::BSD'::BSDBS'::BSDBS'::BSDB'::::::BSD'::
::BSDBSD BSDBSD :.BSDBS':BSDBS .:BSD ..BSD  ...BSD 'BSDBS':BSD .BSD ..BSD  ...BSD :BSDBS'::BSDB .::
::COPYRIGHT2017 ::.BS BSDB .BS :BSD .::.BSD :::.BSD :BS .BSDB .BSD .:::BSD ::::BSD :BS BSDB BS .:::
:::BSDSTYLEBSD .:::BS  BS .:BS :BSD ::::BSD ::::BSD :BS ::BSD :BSD :::::...::::BSD :BS :BS  BS ::::
::::.LICENSE .::::BSD .:..::BS 'BSD ::::BSD ::::BSD :BS :::BS :BSD ::BSDBS'::::BSD :BS ::..:BS ':::
:::::::BSD .::::BSDB .::::::BSD 'BSD'::BSD .:::BSD .BSD :::BSD':BSD'::.BSD :::BSD .BSD :::::BSDB'::
::::::::B .::::::BS .:::::::.BSD ::BSDBS .:BSDBS  :BSD .::::BSD :.BSDBS BS BSDB .:BSD .:::::.BS .::
`::::::::.::::::::..::::::::::...:::.....:::.....:::...::::::...:::.............:::...::::::::..::'
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="mg-common-styles.html">

<dom-module id="mg-variant-cell">
<template strip-whitespace>
    <custom-style>
  <style is="custom-style" include="mg-common-styles iron-flex iron-flex-alignment">

  :host {
    display: inline-block;
    @apply --layout-horizontal;
    @apply --layout-end;
    border-radius: 5px;
  }

  :host(.iron-selected) {
    background-color: rgba(255,99,71, 0.2);
  }

  paper-icon-button {
    width: 37px;
  }

  :host(:not(.iron-selected)) #input {
    pointer-events: none;
  }

  </style>
    </custom-style>

  <paper-icon-button
    icon="close"
    tabindex="-1"
  ></paper-icon-button>

  <paper-input
    id="input"
    style="width:100px"
    value="{{inputValue}}"
    label="[[variantType]]"
    focused="{{inputFocused}}"
    always-float-label="[[inputFocused]]"
  ></paper-input>

  <paper-icon-button
    tabindex="-1"
    icon="content-copy"
  ></paper-icon-button>

  <template is="dom-if" if="[[hasChildren]]">
    <iron-icon style="padding-bottom:8px;color:tomato" icon="chevron-right"></iron-icon>
  </template>

</template>
<script>
(function(){

function measureText(text){
  if (!measureText.context) {
    measureText.context = document.createElement("canvas").getContext("2d");
    measureText.context['font'] = "16px Roboto, Noto, sans-serif";
  }

  let width = measureText.context.measureText(text).width + 10;
  return (width < 100 ? 100 : width)+'px';
};


class MGVariantCell extends Polymer.Element {
  static get is() { return 'mg-variant-cell'; }

  static get properties() { return {
    variant: {
      type: Object,
      observer: '_variantChanged',
    },
    /*
    variantChanged: {
      type: String,
      notify: true,
    },
    */
    variantType: {
      type: String,
    },
    inputValue: {
      type: String,
      observer: '_inputValueChanged',
    },
    selected: {
      type: Boolean,
      value: false,
      observer: '_selectedChanged'
    },
    hasChildren: {
      type: Boolean,
      value: false,
    },
  }}

  static get observers() { return [
  ]}

  _selectedChanged(selected) {
    if (selected) {
      this.$.input.focus();
    }
  }

  _variantChanged(variant) {
    this.set('hasChildren',variant.variants ? true : false);

    if (variant.data) {
      this.set('inputValue', variant.data.value);
    } else {
      this.set('inputValue', '');
    }
  }

  _inputValueChanged(newValue, oldValue) {
    this.$['input'].style['width'] = measureText(newValue);
    this.set('variant.data',{value:newValue});
    /*
    this.set('variantChanged',{key:this.variantKey, data:newValue});
    */
  }

}

customElements.define(MGVariantCell.is, MGVariantCell);
})();
</script>
</dom-module>
