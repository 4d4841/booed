<link rel="import" href="../bower_components/polymer/polymer-element.html">

<dom-module id="mg-list">
  <script>
  (function(){
    class MGMe extends Polymer.Element {
      static get is() { return 'mg-me'; }

      static get properties() { return {

        me: {
          type: Object,
          notify: true,
        },

        displayName: {
          type: String,
          notify: true,
        },

        photoURL: {
          type: String,
          readOnly: true,
          notify: true,
        },

        waiting: {
          type: Boolean,
          value: false,
          notify: true,
        },
      }}

      static get observers() { return [
        '_photoURLChanged(user.photoURL)',
        '_displayNameChanged(user.displayName)',
      ]}

      connectedCallback() {
        super.connectedCallback();
        MGFIRE.auth().onAuthStateChanged(this._onAuthStateChanged.bind(this));
      }

      _onAuthStateChanged(user) {
        this.set('me.user',user);
        this.set('me.waiting', false);
      }

      _displayNameChanged(name) {
        name = name || 'ðŸ‘»';
        this.set('me.displayName', name);
      }

      _photoURLChanged(photoURL) {
        this._setPhotoURL(photoURL);
//        this.set('me.photoURL', photoURL);
      }

      googleSignIn() {
        this.set('me.waiting', true);
        MGFIRE.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL).then(
          function() {
            var provider = new firebase.auth.GoogleAuthProvider();
            return MGFIRE.auth().signInWithRedirect(provider);
          })
          .catch(function(error) {
            var errorCode = error.code;
            var errorMessage = error.message;
            console.log("Error", error);
          });
      }

      signOut() {
        MGFIRE.auth().signOut();
        this.set('me.waiting', false);
      }
    }

    customElements.define(MGMe.is, MGMe);
  })();
  </script>
</dom-module>
