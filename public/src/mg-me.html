<link rel="import" href="../bower_components/polymer/polymer-element.html">

<dom-module id="mg-list">
  <script>
  (function(){
    class MGMe extends Polymer.Element {
      static get is() { return 'mg-me'; }

      static get properties() { return {

        user: {
          type: Object,
          notify: true,
        },

        firebaseApp: {
          type: Object
        },

        displayName: {
          type: String,
          computed: '_displayName(user)'
        },

        photoURL: {
          type: String,
          computed: '_photoURL(user)'
        },

        waiting: {
          type: Boolean,
          value: false,
          notify: true,
        },
      }}

      static get observers() { return [
        '_appInitialized(firebaseApp)',
        '_visibleChanged(visible)',
        '_waitingChanged(me.waiting)',
      ]}

      _appInitialized(firebaseApp) {
        if (firebaseApp) {
          this.set('waiting', true);
          firebaseApp.auth().onAuthStateChanged(this._onAuthStateChanged.bind(this));
        }
      }

      _onAuthStateChanged(user) {
        console.log("me",user);
        this.set('user',user);
        this.set('waiting', false);
      }

      _displayName(user) {
        if (user) {
          return user.displayName;
        }
        return 'ðŸ‘»';
      }

      _photoURL(user) {
        if (user) {
          return user.photoURL;
        }
        return null; //XXX placeholder
      }

      googleSignIn() {
        this.set('waiting', true);
        this.firebaseApp.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL).then(
          function() {
            var provider = new firebase.auth.GoogleAuthProvider();
            return firebase.auth().signInWithRedirect(provider);
          })
          .catch(function(error) {
            var errorCode = error.code;
            var errorMessage = error.message;
            console.log("Error", error);
          });
      }

      signOut() {
        this.firebaseApp.auth().signOut();
        this.set('waiting', false);
      }
    }

    customElements.define(MGMe.is, MGMe);
  })();
  </script>
</dom-module>
