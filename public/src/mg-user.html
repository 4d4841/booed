<!DOCTYPE html>
<!--
 .................................................................................................
:::BSDB'::BSDB'::BSDB':::::BSDB':::BSDBS'::BSDBS'::BSDB'::::BSD'::BSDBS'::BSDBS'::BSDB'::::::BSD'::
::BSDBSD BSDBSD :.BSDBS':BSDBS .:BSD ..BSD  ...BSD 'BSDBS':BSD .BSD ..BSD  ...BSD :BSDBS'::BSDB .::
::COPYRIGHT2017 ::.BS BSDB .BS :BSD .::.BSD :::.BSD :BS .BSDB .BSD .:::BSD ::::BSD :BS BSDB BS .:::
:::BSDSTYLEBSD .:::BS  BS .:BS :BSD ::::BSD ::::BSD :BS ::BSD :BSD :::::...::::BSD :BS :BS  BS ::::
::::.LICENSE .::::BSD .:..::BS 'BSD ::::BSD ::::BSD :BS :::BS :BSD ::BSDBS'::::BSD :BS ::..:BS ':::
:::::::BSD .::::BSDB .::::::BSD 'BSD'::BSD .:::BSD .BSD :::BSD':BSD'::.BSD :::BSD .BSD :::::BSDB'::
::::::::B .::::::BS .:::::::.BSD ::BSDBS .:BSDBS  :BSD .::::BSD :.BSDBS BS BSDB .:BSD .:::::.BS .::
`::::::::.::::::::..::::::::::...:::.....:::.....:::...::::::...:::.............:::...::::::::..::'
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="mg-input.html">
<link rel="import" href="mg-image.html">
<link rel="import" href="mg-profile.html">

<dom-module id="mg-user">
  <template strip-whitespace>
      <custom-style>
    <style is="custom-style" include="mg-common-styles mg-input iron-flex iron-flex-alignment">
      :host {
      }

      a:link {
            text-decoration: none;
      }

      @media (max-width: 767px) {
      }

    </style>
      </custom-style>

    <iron-pages
      selected="[[page]]"
      attr-for-selected="name"
      selected-attribute="visible"
      fallback-selection="404">
      <mg-profile
        name="profile"
        me="{{me}}"
        firebase-app="[[firebaseApp]]">
      </mg-profile>
      <div name="order">
        show order
      </div>
      <div name="products">
        show products
      </div>
      <div name="store">
        show store
      </div>
      <div name="inbox">
        show inbox
      </div>
      <div name="help">
        show help
      </div>
    </iron-page>

    <app-route
        active="{{routeActive}}"
        route="{{route}}"
        pattern="/:page"
        data="{{routeData}}"
        tail="{{subroute}}">
    </app-route>

  </template>
  <script>
    class MGUser extends Polymer.Element {
      static get is() { return 'mg-user'; }

      static get properties() { return {
        /*
        route: {
          type: Object,
          notify: true
        },
        */

        route: Object,

        subroute: {
          type: Object,
          notify: true
        },

        routeData: {
          type: Object,
          notify: true
        },

        page: {
          type: String,
          reflectToAttribute: true,
          observer: '_pageChanged'
        },

        me: {
          type: Object,
          notify: true
        },

        menu: {
          type: Array,
          notify: true
        },

        userMenu: {
          type: Array,
          notify: true
        },

        visible: {
          type: Boolean,
          reflectToAttribute: true,
          value: false
        },
      }}

      static get observers() { return [
        '_routeDataChanged(routeData, routeData.page)',
        '_userChanged(me.User)',
        '_visibleChanged(visible,menu)',
      ]}

      _visibleChanged( visible, menu ) {
        if (visible) {
          this.dispatchEvent(new CustomEvent('change-section', {
            bubbles: true, composed: true, detail: {target:this}}));
        }
      }

      _routeDataChanged( routeData, page ) {
        this.page = routeData.page || 'profile';
        if (routeData.page != 'profile') {
          this.set('routeData.page', this.page);
        }
      }

      _pageChanged( pg ) {
        console.log("pg is", pg,this.route.prefix,this.route.path);
      }

      _tabSelected(tab) {
        console.log("user-tab",tab);
      }

      _userChanged(user) {
        if (user) {
          this.menu = [
            {name:"profile", path:"/user/profile", icon:"face", title:"‡πÇ‡∏û‡∏£‡πÑ‡∏ü‡∏•‡πå"},
            {name:"order", path:"/user/order", icon:"credit-card", title:"‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠"},
            {name:"products", path:"/user/products", icon:"local-mall", title:"‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤"},
            {name:"store", path:"/user/store", icon:"store", title:"‡∏£‡πâ‡∏≤‡∏ô"},
            {name:"inbox", path:"/user/inbox", icon:"inbox", title:"‡∏≠‡∏¥‡∏ô‡∏ö‡∏≠‡∏Å‡∏ã‡πå"},
            {name:"help", icon:"help", title:"‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠", submenu:[
              {name:"tos", path:"/about/tos", icon:"info", title:"‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£", },
              {name:"policy", path:"/about/policy", icon:"info", title:"‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß"},
            ]},
          ];
          this.userMenu = [
            { name:"user-menu",
              title: this.me.User.email,
              icon: "account-box",
              submenu: [
                {name:"profile", path:"/user/profile", icon:"face", title:"‡πÇ‡∏û‡∏£‡πÑ‡∏ü‡∏•‡πå"},
                {name:"signout", action:"_signOut", icon:"coffee", color:"tomato", title:"‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö"},
              ]
            }
          ];
        } else {
          this.menu = [
            {name:"signin", icon:"lock", title:"‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö"},
            {name:"help", icon:"help", title:"‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠", submenu:[
              {name:"tos", path:"/about/tos", icon:"info", title:"‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£", },
              {name:"policy", path:"/about/policy", icon:"info", title:"‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß"},
            ]},
          ];
          this.userMenu = null;
        }
      }

      /*
      _visualChanged(visible,menu) {
        if (this.visible) {
          this.dispatchEvent(new CustomEvent('change-section', {
            bubbles: true, composed: true, detail: {title: 'User : üëª', menu:this.menu}}));
        }
      }
      */
    }

    customElements.define(MGUser.is, MGUser);
  </script>
</dom-module>
