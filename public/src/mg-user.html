<!DOCTYPE html>
<!--
 .................................................................................................
:::BSDB'::BSDB'::BSDB':::::BSDB':::BSDBS'::BSDBS'::BSDB'::::BSD'::BSDBS'::BSDBS'::BSDB'::::::BSD'::
::BSDBSD BSDBSD :.BSDBS':BSDBS .:BSD ..BSD  ...BSD 'BSDBS':BSD .BSD ..BSD  ...BSD :BSDBS'::BSDB .::
::COPYRIGHT2017 ::.BS BSDB .BS :BSD .::.BSD :::.BSD :BS .BSDB .BSD .:::BSD ::::BSD :BS BSDB BS .:::
:::BSDSTYLEBSD .:::BS  BS .:BS :BSD ::::BSD ::::BSD :BS ::BSD :BSD :::::...::::BSD :BS :BS  BS ::::
::::.LICENSE .::::BSD .:..::BS 'BSD ::::BSD ::::BSD :BS :::BS :BSD ::BSDBS'::::BSD :BS ::..:BS ':::
:::::::BSD .::::BSDB .::::::BSD 'BSD'::BSD .:::BSD .BSD :::BSD':BSD'::.BSD :::BSD .BSD :::::BSDB'::
::::::::B .::::::BS .:::::::.BSD ::BSDBS .:BSDBS  :BSD .::::BSD :.BSDBS BS BSDB .:BSD .:::::.BS .::
`::::::::.::::::::..::::::::::...:::.....:::.....:::...::::::...:::.............:::...::::::::..::'
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="mg-profile.html">
<link rel="import" href="mg-items.html">

<dom-module id="mg-user">
  <template strip-whitespace>
      <custom-style>
    <style is="custom-style" include="mg-common-styles iron-flex iron-flex-alignment">
      :host {
      }

      @media (max-width: 767px) {
      }

    </style>
      </custom-style>

    <iron-pages
      selected="[[page]]"
      attr-for-selected="name"
      selected-attribute="visible"
      fallback-selection="404">
      <mg-profile
        name="profile"
        me="{{me}}"
        firebase-app="[[firebaseApp]]">
      </mg-profile>
      <div name="order">
        show order
      </div>
      <mg-items id="items" name="items">
        show products
      </mg-items>
      <div name="store">
        show store
      </div>
      <div name="inbox">
        show inbox
      </div>
      <div name="help">
        show help
      </div>
    </iron-page>

    <app-route
        active="{{routeActive}}"
        route="{{route}}"
        pattern="/:page"
        data="{{routeData}}"
        tail="{{subroute}}">
    </app-route>

  </template>
  <script>
    class MGUser extends Polymer.Element {
      static get is() { return 'mg-user'; }

      static get properties() { return {
        /*
        route: {
          type: Object,
          notify: true
        },
        */

        route: Object,

        subroute: {
          type: Object,
          notify: true
        },

        routeData: {
          type: Object,
          notify: true
        },

        page: {
          type: String,
          reflectToAttribute: true,
          notify: true,
          observer: '_pageChanged'
        },

        me: {
          type: Object,
          notify: true
        },

        menu: {
          type: Array,
          notify: true
        },

        userMenu: {
          type: Array,
          notify: true
        },

        visible: {
          type: Boolean,
          reflectToAttribute: true,
          value: false
        },
      }}

      static get observers() { return [
        '_routeDataChanged(routeData, routeData.page)',
        '_userChanged(me.User)',
        '_visibleChanged(visible,menu)',
      ]}

      _visibleChanged( visible, menu ) {
        if (visible) {
          this.dispatchEvent(new CustomEvent('change-section', {
            bubbles: true, composed: true, detail: {target:this}}));
        }
      }

      _routeDataChanged( routeData, page ) {
        this.page = routeData.page || 'profile';

        if (this.routeData.page != this.page) {
          this.set('routeData.page', this.page);
        }

        this._pageChanged(page);
      }

      _pageChanged( pg ) {
        if (this.routeData.page != this.page) {
          this.set('routeData.page', this.page);
        }
        this.dispatchEvent(new CustomEvent('change-section', {
          bubbles: true,
          composed: true,
          detail: {title: pg && pg[0].toUpperCase() + pg.slice(1)}
         }));
      }

      _tabSelected(tab) {
        console.log("user-tab",tab);
      }

      _userChanged(user) {
        if (user) {
          this.menu = { entries: [
            { name:"profile", path:"/user/profile", icon:"face", title:"‡πÇ‡∏û‡∏£‡πÑ‡∏ü‡∏•‡πå"},
            { name:"order", path:"/user/order", icon:"credit-card", title:"‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠"},
            { name:"items", path:"/user/items", icon:"widgets", title:"‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°",
              submenu: { entries:[
                  { name:"products", path:"/user/items/products", icon:"local-mall", title:"‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" },
                  { name:"articles", path:"/user/items/articles", icon:"local-library", title:"‡∏≠‡∏≤‡∏£‡πå‡∏ï‡∏¥‡πÄ‡∏Ñ‡∏¥‡∏•" },
                  { name:"collections", path:"/user/items/collections", icon:"group-work", title:"‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Ñ‡∏ä‡∏±‡πà‡∏ô" },
                  { name:"galleries", path:"/user/items/galleries", icon:"photo-library", title:"‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡πà" },
              ]}
            },
            { name:"store", path:"/user/store", icon:"store", title:"‡∏£‡πâ‡∏≤‡∏ô"},
            { name:"inbox", path:"/user/inbox", icon:"inbox", title:"‡∏≠‡∏¥‡∏ô‡∏ö‡∏≠‡∏Å‡∏ã‡πå"},
            { name:"help", icon:"help", title:"‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠",
              submenu: { entries:[
                  { name:"tos", path:"/about/tos", icon:"info", title:"‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£", },
                  { name:"policy", path:"/about/policy", icon:"info", title:"‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß"},
              ]}
            },
          ]};
          this.userMenu = { entries: [
            { name: "user-menu",
              title: this.me.User.email,
              icon: "account-box",
              submenu: { entries:[
                { name:"profile", path:"/user/profile", icon:"face", title:"‡πÇ‡∏û‡∏£‡πÑ‡∏ü‡∏•‡πå"},
                { name:"signout", action:"_signOut", icon:"local-cafe", color:"tomato", title:"‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö"},
              ]}
            }
          ]};
        } else {
          this.menu = { entries: [
            { name: "profile", path: "/user/profile", icon: "lock", title: "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö"},
            { name: "help", icon: "help", title: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠",
              submenu: { entries: [
                  { name: "tos", path: "/about/tos", icon: "info", title: "‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£", },
                  { name:"policy", path:"/about/policy", icon:"info", title:"‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß" },
              ]}
            },
          ]};
          this.userMenu = null;
        }
      }

      /*
      _visualChanged(visible,menu) {
        if (this.visible) {
          this.dispatchEvent(new CustomEvent('change-section', {
            bubbles: true, composed: true, detail: {title: 'User : üëª', menu:this.menu}}));
        }
      }
      */
    }

    customElements.define(MGUser.is, MGUser);
  </script>
</dom-module>
